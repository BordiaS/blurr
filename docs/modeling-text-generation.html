---

title: modeling.text_generation

keywords: fastai
sidebar: home_sidebar

summary: "This module contains custom models, loss functions, custom splitters, etc... for token classification tasks like summarization."
description: "This module contains custom models, loss functions, custom splitters, etc... for token classification tasks like summarization."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02e_modeling-text-generation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#cuda</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using GPU #</span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">current_device</span><span class="p">()</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using GPU #1: GeForce GTX 1080 Ti
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Text-generation">Text generation<a class="anchor-link" href="#Text-generation"> </a></h2><p>The objective of text generation is to create reasonable textual responses given a prior piece of input.  For example, we may want to summarize an article in a single sentence or have a chatbot provide a sensible response to a question.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
<span class="n">cnndm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;cnndm_sample.csv&#39;</span><span class="p">);</span> <span class="nb">len</span><span class="p">(</span><span class="n">cnndm_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1000</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cnndm_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article</th>
      <th>highlights</th>
      <th>ds_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(CNN)  -- Globalization washes like a flood over the world's cultures and economies. Floods can be destructive; however, they can also bring blessings, as the annual floods of the Nile did for ancient Egypt. The world's great universities can be crucial instruments in shaping, in a positive way, humankind's reaction to globalization and the development of humankind itself. Traditionally, universities have been defined and limited by location, creating an academic community and drawing students and scholars to that place. Eventually, some universities began to encourage students to study el...</td>
      <td>John Sexton: Traditionally, universities have been defined and limited by location .\nGlobal campuses form a network of thought, innovation, he writes .\nFaculty can teach, Sexton says, students can team up in many cities at once .\nSexton: Research, scholarship can be shared and cultural ties made in "century of knowledge"</td>
      <td>train</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(CNN) -- Armenian President Robert Kocharian declared a state of emergency Saturday night after a day of clashes between police and protesters, a spokeswoman for the Armenian Foreign Ministry said. Opposition supporters wave an Armenian flag during a protest rally in Yerevan, Armenia, on Saturday. The protesters claim last month's presidential election was rigged. The state of emergency will "hopefully bring some order" to the capital, Yerevan, said Salpi Ghazarian, assistant to the Armenian foreign minister, who spoke to CNN early Sunday. The state of emergency could last until March 20, ...</td>
      <td>NEW: Protest moves after crackdown at Freedom Square .\nOrder sought after protests over last month's election turn violent .\nDemonstrators say the election was fraudulent .\nState of emergency could last until March 20, official says .</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;bart-large-cnn&quot;</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> \
    <span class="n">BLURR_MODEL_HELPER</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">BartTokenizer</span><span class="p">,</span> <span class="n">HF_MODELS</span><span class="o">.</span><span class="n">BartForConditionalGeneration</span><span class="p">)</span>

<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;bart&#39;,
 transformers.tokenization_bart.BartTokenizer,
 transformers.configuration_bart.BartConfig,
 transformers.modeling_bart.BartForConditionalGeneration)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span> 
    <span class="n">HF_TextBlock</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">),</span> 
    <span class="n">HF_TextBlock</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">ForConditionalGenerationTask</span><span class="p">(),</span> <span class="n">trg_max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> 
                   <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">),</span> 
                   <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;highlights&#39;</span><span class="p">),</span> 
                   <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">cnndm_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([4, 512]), torch.Size([4, 250]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="o">=</span><span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(CNN) -- Home to up to 10 percent of all known species, Mexico is recognized as one of the most biodiverse regions on the planet. The twin threats of climate change and human encroachment on natural environments are, however, threatening the existence of the country's rich wildlife. And there is a great deal to lose. In the United Nations Environment Program (UNEP) World Conservation Monitoring Centre's list of megadiverse countries Mexico ranks 11th. The list represents a group of 17 countries that harbor the majority of the Earth's species and are therefore considered extremely biodiverse. From its coral reefs in the Caribbean Sea to its tropical jungles in Chiapas and the Yucatan peninsula and its deserts and prairies in the north, Mexico boasts an incredibly rich variety of flora and fauna. Some 574 out of 717 reptile species found in Mexico -- the most in any country -- can only be encountered within its borders. It is home to 502 types of mammals, 290 species of birds, 1,150 varieties of birds and 26,000 classifications of plants. Pronatura, a non-profit organization that works to promote conservation and sustainable development in Mexico, has selected six species which it says symbolize the problems faced by the destruction of nature. "These are only some of the species which have some degree of conservation," says Eduardo Cota Corona, Director of Conservation at Pronatura. "However, there is a countless number of species in Mexico which find themselves in danger of extinction." Golden Eagle. It is the country's national symbol yet the Golden Eagle is close to extinction in Mexico. One of the largest raptors or birds of prey in the world, the Golden Eagle's wingspan can reach lengths greater than two metres. Only the Bald Eagle and the California Greater exceed it in size in North America. With its powerful hooked bill and long and sharp claws it can sometimes capture prey of a size that is surprising for its size, including crane, wild ungulates and domestic livestock, though more often than not it tends to feed off small mammals such as rabbits, hares, ground squirrels and prairie dogs as well as reptiles and small-to-medium sized birds. Primarily a solitary bird, the Golden Eagle pairs up to breed, building nests made of dry branches in cliffs and escarpments. The female typically lays two eggs which are incubated by both the male and female. Usually, only one of the hatchlings survives. The Golden Eagle can be found in</td>
      <td>Mexico hosts to up to 10 percent of all known species on Earth.\nIt is home to 502 types of mammals, 290 bird species and 26,000 types of plants.\nHuman development and climate change is placing a big strain on its biodiversity.\nThe Golden Eagle is under threat in spite of being the country's national symbol.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>London (CNN) -- In 1948, a hospital outside London witnessed the birth of the Paralympic movement, as a Jewish doctor who had fled Nazi Germany sought to change the lives of patients with spinal injuries -- and inspire new hope in them through sport. The first "Stoke Mandeville Games" were organized in 1948 to coincide with the London Olympics, the second to be held in Britain. Named for the hospital in Buckinghamshire where Prof. Ludwig Guttmann's pioneering spinal injuries unit was based, the competitors in those initial Games -- 14 men and two women -- took part in a wheelchair archery contest. Many were military veterans injured on the battlefields of World War II. Just a year later, six teams competed at Stoke Mandeville -- with wheelchair netball, a forerunner of wheelchair basketball, being introduced -- as sport became a central part of a rehabilitation process that had been revolutionized by Guttmann. In 1956, a "statement of intent" was unveiled for the Games, which were by this time international, according to to the Mandeville Legacy website run by the local authority. It read: "The aim of the Stoke Mandeville Games is to unite paralyzed men and women from all parts of the world in an international sports movement, and your spirit of true sportsmanship today will give hope and inspiration to thousands of paralyzed people." Four years later, inspired by Guttmann's vision, the first official Paralympic Games were held in Rome in tandem with the Olympics. And five decades on, some 4,280 Paralympians from 165 countries -- the largest number ever -- have returned to Britain to compete in what is now the premier international sporting event for those born with disabilities, or disabled by injury or illness. In an echo of those first Stoke Mandeville Games, a number of those competing are military veterans, this time wounded in action in Iraq and Afghanistan. Blinded in Afghanistan. The United States' 227-member 2012 Paralympic team includes 20 military veterans and active-duty service members, almost 10% of the total. Among them is Navy Lt. Bradley Snyder, blinded last September in Afghanistan when a homemade bomb exploded in his face. He will compete in a swimming event on the anniversary of his injury, the Team USA website says. Described by the United States Association of Blind Athletes as "an inspiration to others and a true American hero," Snyder -- who made the swim team while at the U.S. Naval Academy -- returned to the sport within weeks of losing</td>
      <td>Paralympic movement was born in Stoke Mandeville, outside London, in 1948.\n2012 Games will be the biggest yet, with 4,200 competitors from 165 countries.\nIn an echo of the first, post-World War II Games, injured veterans are among the athletes.\nThey include a U.S. naval officer blinded in Afghanistan and a Briton who lost an arm in Iraq.</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HF_TextGenerationModelWrapper" class="doc_header"><code>class</code> <code>HF_TextGenerationModelWrapper</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/text_generation.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HF_TextGenerationModelWrapper</code>(<strong><code>hf_model</code></strong>) :: <a href="/blurr/modeling-core#HF_BaseModelWrapper"><code>HF_BaseModelWrapper</code></a></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In additiont to updating our model wrapper to allow us to include <code>decoder_input_ids</code>, below we add a custom param splitter to give us a bit more depth in applying discriminative learning rates.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="text_gen_splitter" class="doc_header"><code>text_gen_splitter</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/text_generation.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>text_gen_splitter</code>(<strong><code>m</code></strong>, <strong><code>arch</code></strong>)</p>
</blockquote>
<p>Custom param splitter for text generation models</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">HF_TextGenerationModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> 
                <span class="n">model</span><span class="p">,</span>
                <span class="n">opt_func</span><span class="o">=</span><span class="n">ranger</span><span class="p">,</span>
                <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="n">hf_tokenizer</span><span class="o">.</span><span class="n">pad_token_id</span><span class="p">),</span>
                <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">HF_BaseModelCallback</span><span class="p">],</span>
                <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">text_gen_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">))</span><span class="c1">#.to_fp16()</span>

<span class="n">learn</span><span class="o">.</span><span class="n">create_opt</span><span class="p">()</span> 
<span class="n">learn</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># learn.summary()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span><span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([4, 250, 50264]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, 4, torch.Size([4, 512]), 4, torch.Size([4, 250]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#slow</span>
<span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggestions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(lr_min=0.017378008365631102, lr_steep=9.12010818865383e-07)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#slow</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">3e-5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3.413566</td>
      <td>3.278910</td>
      <td>01:11</td>
    </tr>
    <tr>
      <td>1</td>
      <td>3.510733</td>
      <td>3.266483</td>
      <td>01:11</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3.536877</td>
      <td>3.264698</td>
      <td>01:11</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="o">=</span><span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>(CNN Student News) -- October 27, 2009. Downloadable Maps. Download PDF maps related to today's show:  • Afghanistan &amp; Pakistan • Los Angeles &amp; San Diego • Ft. Jackson, South Carolina. Transcript. THIS IS A RUSH TRANSCRIPT. THIS COPY MAY NOT BE IN ITS FINAL FORM AND MAY BE UPDATED. NATISHA LANCE, CNN STUDENT NEWS ANCHOR: A member of the military is making history. We'll explain how in today's edition of CNN Student News. Hi, everyone. Carl Azuz is off this week. I'm Natisha Lance. First Up: Afghan Crashes. LANCE: First up, Pakistan and Afghanistan. The countries share a border, and they also share a common problem: threats from militant groups and terrorists like the Taliban and al Qaeda. It's an issue facing both nations' governments, and one that the U.S. government is concerned about as well. That's why President Obama has been holding a series of meetings with some of his advisers. They're reviewing the U.S. strategy in Afghanistan and Pakistan. Samantha Hayes has the latest on those meetings and on the violence in the region. (BEGIN VIDEO) SAMANTHA HAYES, CNN CORRESPONDENT, WASHINGTON, D.C.: Two helicopter crashes make it the deadliest day in four years for Americans in Afghanistan. While a NATO security force spokesman says enemy fire is not to blame, the loss of 14 Americans comes while President Barack Obama is considering a request to send thousands more troops to the region to fight al Qaeda. The president addressed service men and women in Jacksonville, Florida Monday, after a White House meeting with his national security team. U.S. PRESIDENT BARACK OBAMA: Fourteen Americans gave their lives, and our prayers are with these service members, their civilian colleagues and the families who loved them. HAYES: The deadliest of the two crashes happened following a raid on suspected drug traffickers, and three DEA agents were among those killed. Also among the dead, three U.S. civilians, members of the embassy community. The State Department says the efforts of civilians and other nonmilitary personnel are essential to the overall mission. JACOB LEW, DEPUTY SECRETARY OF STATE: Improving Afghan governance, providing security, justice, jobs and services, and giving the Afghan people a meaningful alternative, as much as possible, to the Taliban's recruiting. HAYES: Democratic Senator John Kerry, off</td>
      <td>Consider U.S. efforts to offer Afghan citizens an alternative to the Taliban.\nHear how a proposed health care bill addresses the issue of the public option.\nMeet a soldier who is making history at the U.S. Army Drill Sergeant School.\nUse the Daily Discussion to help students understand today's featured news stories.</td>
      <td>&lt;s&gt;..S. President to fight Afghan people a alternative to the Taliban.&lt;/s&gt;.AY how a member law care bill would the issue. mental T</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(CNN) -- Wondering where to go for your next holiday? Experts explain which destinations we should be checking out in 2014. Brazil: The World Cup. The modern game of football, or soccer, may have been born in England's public schools, but many will claim its soul has settled in Brazil. It has the world's most successful international team, winning the World Cup five times. It calls what many claim to be the world's greatest player, Pele, one of its own. And company managers and bosses are known to demand their employees skip work to watch the big games. The World Cup next year then, to be hosted over June and July in 18 cities across the country, is likely to be memorable, to say the least. Throw in the rest of the country, which includes rainforests, beaches and a party culture that makes most New Year's Eve soirees look decidedly po-faced, and you have the makings of an epic trip. Daisy Parker from ABTA (Association of British Travel Agents) suggests visiting some of the country's more remote areas. "The Brazilians' love of a party is going to make it a must-visit long haul destination for 2014," she says. "Once fans have flown that far we predict many will stay on to check out areas like the Amazon basin and the amazing Iguazu Falls. Brazil's beaches are also some of the best in the world." Explore offers a 14-day Pure Brazil tour, which starts from $5,913 per person (not including flights). Panama: Canal's 100th birthday. The Panama Canal's 100-year anniversary arguably is not, in and of itself, a top five reason for visiting the country in 2014. But the events surrounding the big day and Panama's other attractions certainly are. "August 2014 marks 100 years since the completion of the Panama Canal, and that's likely to attract more attention to the destination," says Mary Moses, general manager at PEAK South America. "However, Panama has a lot more to offer travelers than just the canal -- volcanoes, rainforests, coffee plantations and beautiful beaches on both the Atlantic and Pacific coasts." Peregrine Adventures offers a 10-day Panama Highlights tour. Prices start from $2,171 per person (excluding flights). Myanmar: Tourism 'Master Plan' Myanmar has been touted as "the next big tourism destination" for a few years already, but getting around the country has proved tricky. ATMs have been absent or limited to</td>
      <td>New Zealand government threw $50 million into the construction of the Nga Haerenga cycle trails.\nNosara in Costa Rica recently awarded a Blue Flag -- a certification awarded to world's best beaches.\nFirst few months of 2014 best period for Northern Lights for years, as NASA scientists predict a peak in solar activity.</td>
      <td>Brazila is to open1 million into development economy of the newga'velnga Dam route.&lt;/s&gt;.gay, the Rica is became the UNESCO Star fo</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The predictions of our <code>show_results</code> are the greedy predicted values from the model. <code>Learner.predict</code> will follow the same approach.</p>
<p>Below we'll look at how we can use huggingface's <code>PreTrainedModel.generate</code> method to create something more reasonable.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_article</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">To Disney or not to Disney? For many travelers, especially those with children, it&#39;s not even a question they ask. </span>
<span class="s2">They already know the answer. &quot;Yes.&quot; To these visitors, Disney is Mickey Mouse, princesses, magic and fun. It&#39;s </span>
<span class="s2">happy memories of childhood brought back to life in your children, a clean place where the rides are safe and the </span>
<span class="s2">Disney characters are always happy to pose for pictures with your kids. That&#39;s Deb Koma, who visited once as a </span>
<span class="s2">child and walked back into the Magic Kingdom in the mid-1990s with her young son. &quot;It was so perfect, everybody </span>
<span class="s2">was so happy, everything was so maintained,&quot; said Koma, who now works for the AllEars.net, an unofficial Disney </span>
<span class="s2">planning and fan site. &quot;You were in a perfect fantasy world. That, and my little boy loved it.&quot; But for other </span>
<span class="s2">vacationers, Disney inspires a firm &quot;no.&quot; To those travelers, Disney is merely a commercial machine built to </span>
<span class="s2">sell tickets, overpriced toys and a stereotype of girls as princesses. They may remember visiting Disneyland </span>
<span class="s2">or Disney World when they were children, but they aren&#39;t taking their kids there. Downtown Disney to make way </span>
<span class="s2">for Disney Springs. That&#39;s the Rev. J.C. Mitchell, who will be heading to Orlando, Florida, this year for a work </span>
<span class="s2">conference but will not be taking his family with him, even though his job will cover most of the costs of his </span>
<span class="s2">trip. &quot;We do not enjoy Disney,&quot; wrote Mitchell, who went to Disney World as a child, via e-mail. &quot;We believe </span>
<span class="s2">it symbolically represents the excesses of our extremely individualistic society.&quot; What is it about Disney </span>
<span class="s2">that creates such a strong response from its dedicated fans and foes? Whether you love or hate or merely </span>
<span class="s2">tolerate the expansion of what Walt Disney started in 1923, there&#39;s no doubting that Disney is popular </span>
<span class="s2">and its influence is everywhere. All of those theme parks, resorts, cruises, movies, television shows, </span>
<span class="s2">toys and other Disney businesses earned the company  11.3𝑏𝑖𝑙𝑙𝑖𝑜𝑛𝑖𝑛𝑡ℎ𝑒𝑙𝑎𝑠𝑡𝑡ℎ𝑟𝑒𝑒𝑚𝑜𝑛𝑡ℎ𝑠𝑜𝑓2012.𝑀𝑜𝑟𝑒𝑡ℎ𝑎𝑛 3 billion </span>
<span class="s2">of that money came from Disney cruises and its 11 theme parks and 43 resorts across North America, Europe </span>
<span class="s2">and Asia. One more park is under construction in Shanghai. People like Disney. It ranked as the third most </span>
<span class="s2">well-regarded company--behind only Amazon.com and Apple--in a recent Harris Interactive survey of people&#39;s </span>
<span class="s2">opinions of the most visible companies&#39; reputations. </span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_article</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">150</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>DisneyDisney. some fans not to Disney? For many travelers, the those with children, it&#39;s not even a question they ask. To                , already kno
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That doesn't look much like a human-generated summary.  Let's use huggingface's <code>PreTrainedModel.generate</code> method to create something more human-like.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_input_ids</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hf_model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="n">gen_text</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hf_model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">test_input_ids</span><span class="p">,</span> <span class="n">num_beams</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== Target ===&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">hf_tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clean_up_tokenization_spaces</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== Prediction ===&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">gen_text</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clean_up_tokenization_spaces</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Target ===
 Virginia Tech did not send timely warnings, the federal government says .
The university says it will appeal decision .
It claims it met rules that were current at the time; the U.S. Department of Education disagrees .

=== Prediction ===
NEW: Virginia Tech &#34;respectfully disagrees&#34; with the fine, a university official says. The school did not notify students in a &#34;timely manner,&#34; a 2010 report says. 32 people died in a 2007 rampage at Virginia Tech&#39;s Norris Hall. The Clery Act requires colleges and universities to disclose crimes on or near campuses.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll add a <code>generate_text</code> method to <code>Learner</code> that uses huggingface's <code>PreTrainedModel.generate</code> to create our predictions.</p>
<p>For the full list of arguments you can pass in see <a href="https://huggingface.co/transformers/main_classes/model.html#transformers.PreTrainedModel.generate">here</a>. You can also check out their <a href="https://github.com/huggingface/blog/blob/master/notebooks/02_how_to_generate.ipynb">"How To Generate"</a> notebook for more information about how it all works.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Learner.generate_text" class="doc_header"><code>Learner.generate_text</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/text_generation.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Learner.generate_text</code>(<strong><code>inp</code></strong>, <strong><code>max_length</code></strong>=<em><code>130</code></em>, <strong><code>min_length</code></strong>=<em><code>30</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Uses the built-in <code>generate</code> method to generate the text
(see <a href="https://huggingface.co/transformers/main_classes/model.html#transformers.PreTrainedModel.generate">here</a>
for a list of arguments you can pass in)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">generate_text</span><span class="p">(</span><span class="n">test_article</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_beams</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;=== Prediction </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> ===</span><span class="se">\n</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Prediction 1 ===
Disney has 11 theme parks and 43 resorts across North America, Europe, Asia. It ranked as the third most well-regarded company in a recent Harris Interactive survey. The Rev. J.C. Mitchell: &#34;We do not enjoy Disney&#34;

=== Prediction 2 ===
Disney has 11 theme parks and 43 resorts across North America, Europe, Asia. It ranked as the third most well-regarded company in a recent Harris Interactive survey. The Rev. J.C. Mitchell: &#34;We do not enjoy Disney.&#34;

=== Prediction 3 ===
Disney has 11 theme parks and 43 resorts across North America, Europe, Asia. It ranked as the third most well-regarded company in a recent Harris Interactive survey.

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Much nicer!!! What about inference?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;text_gen_learn_export.pkl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;text_gen_learn_export.pkl&#39;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">generate_text</span><span class="p">(</span><span class="n">test_article</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Disney has 11 theme parks and 43 resorts across North America, Europe, Asia. It ranked as the third most well-regarded company in a recent Harris Interactive survey. The Rev. J.C. Mitchell: &#34;We do not enjoy Disney&#34;&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cleanup">Cleanup<a class="anchor-link" href="#Cleanup"> </a></h2>
</div>
</div>
</div>
</div>
 

